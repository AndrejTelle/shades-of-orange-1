<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<post>
  <author>oliver</author>
  <title>Creating a new module in ‘discoverize’ – using multi-file templates and good ol’ batch scripts</title>
  <description />
  <content>&lt;p&gt;For our portal software discoverize I was looking for a way to create new modules faster and more reliably. The basic structure would always be the same, so a Visual Studio multi-file template seemed appropriate:&lt;/p&gt;  &lt;p&gt;&lt;a href="http://shades-of-orange.com/image.axd?picture=module.png"&gt;&lt;img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="module" border="0" alt="module" src="http://shades-of-orange.com/image.axd?picture=module_thumb.png" width="238" height="241" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;Well, unfortunately I didn’t find a way to create new folders with that approach. Multi-file templates really do what they say: they create multiple &lt;strong&gt;files&lt;/strong&gt; from templates. Nothing else.&lt;/p&gt;  &lt;p&gt;So I put together a short batch script that would create the directory structure needed for any new module:&lt;/p&gt;  &lt;p&gt;&lt;a href="http://shades-of-orange.com/image.axd?picture=image_2.png"&gt;&lt;img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://shades-of-orange.com/image.axd?picture=image_thumb_2.png" width="485" height="303" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;I can quickly open a new command line window by using any one of several Visual Studio extensions (e.g. PowerCommands for Visual Studio 2010):&lt;/p&gt;  &lt;p&gt;&lt;a href="http://shades-of-orange.com/image.axd?picture=image_3.png"&gt;&lt;img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://shades-of-orange.com/image.axd?picture=image_thumb_3.png" width="316" height="202" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;… and simply run:&lt;/p&gt;  &lt;p&gt;&lt;a href="http://shades-of-orange.com/image.axd?picture=image_4.png"&gt;&lt;img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://shades-of-orange.com/image.axd?picture=image_thumb_4.png" width="680" height="110" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;Now going back to Visual Studio we have to include the new Feature folder in the project:&lt;/p&gt;  &lt;p&gt;&lt;a href="http://shades-of-orange.com/image.axd?picture=image_5.png"&gt;&lt;img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://shades-of-orange.com/image.axd?picture=image_thumb_5.png" width="288" height="230" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;Then hit Ctrl + Shift + A to open the Add New Item dialog, select ‘Discoverize Module’ and type Feature in the Name textbox (unfortunately, there seems to be no easy way to automatically put the name of the folder inside that textbox):&lt;/p&gt;  &lt;p&gt;&lt;a href="http://shades-of-orange.com/image.axd?picture=image_6.png"&gt;&lt;img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://shades-of-orange.com/image.axd?picture=image_thumb_6.png" width="577" height="391" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;This step will generate three code files, that are the backbone of every module: FeatureConfig.cs, FeatureModule.cs, and FeatureViews.cs. Finally, our multi-file item template comes into play!&lt;/p&gt;  &lt;h2&gt;Handling the multi-file template&lt;/h2&gt;  &lt;p&gt;The multi-file item template for a new module consists of four files: the template definition file Module.vstemplate and the template code files Config.cs, Module.cs, and Views.cs:&lt;/p&gt;  &lt;p&gt;&lt;a href="http://shades-of-orange.com/image.axd?picture=image_7.png"&gt;&lt;img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://shades-of-orange.com/image.axd?picture=image_thumb_7.png" width="425" height="188" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;h3&gt;&lt;/h3&gt;  &lt;p&gt;Those four files have to be packed into a zip file and copied to a folder underneath &lt;strong&gt;%UserProfile%\My Documents\Visual Studio 2010\Templates\ItemTemplates\&lt;/strong&gt; – I put this one into &lt;strong&gt;Visual C#\Code&lt;/strong&gt;. That’s how it appeared under the Visual C# –&amp;gt; Code section in the Add New Item dialog.&lt;/p&gt;  &lt;p&gt;Since it is somewhat cumbersome to zip and copy updated versions of the template (especially during early development where I keep adjusting and tuning the template code), I put together another batch file that does that for me. It basically does three things:&lt;/p&gt;  &lt;ol&gt;   &lt;li&gt;Get the name of current folder to use as name for the zip file (found the solution &lt;a href="http://stackoverflow.com/questions/280969/windows-batch-loop-over-folder-string-and-parse-out-last-folder-name"&gt;here&lt;/a&gt;) &lt;/li&gt;    &lt;li&gt;Use 7-zip to zip the four files. &lt;/li&gt;    &lt;li&gt;Copy the zip file to the VS custom template directory. &lt;/li&gt; &lt;/ol&gt;  &lt;p&gt;&lt;a href="http://shades-of-orange.com/image.axd?picture=image_8.png"&gt;&lt;img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://shades-of-orange.com/image.axd?picture=image_thumb_8.png" width="798" height="407" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;The &lt;a href="https://gist.github.com/1084221" target="_blank"&gt;real script&lt;/a&gt; contains some safety nets and more output so that in case it won’t work across all developer machines I can get quick feedback as to &lt;strong&gt;what exactly didn’t work&lt;/strong&gt; instead of just “it didn’t work”.&lt;/p&gt;  &lt;p&gt;Happy Coding!&lt;/p&gt;</content>
  <ispublished>True</ispublished>
  <isdeleted>False</isdeleted>
  <iscommentsenabled>True</iscommentsenabled>
  <pubDate>2011-07-15 09:07:06</pubDate>
  <lastModified>2011-07-15 09:32:47</lastModified>
  <raters>0</raters>
  <rating>0</rating>
  <slug>Creating-a-new-module-in-discoverize-using-multi-file-templates-and-good-ol-batch-scripts</slug>
  <tags>
    <tag>batch</tag>
    <tag>item-template</tag>
  </tags>
  <comments />
  <categories>
    <category>678a9d57-c1ea-487a-8fd3-4d08dc0be9c4</category>
    <category>9c2910dd-8a70-451f-b9d5-0ec47609aedb</category>
    <category>b9df7adf-328a-4e8c-9401-f5adf7e10cd6</category>
    <category>4a6eca6b-10d9-4a5f-ab67-40144ba581d9</category>
  </categories>
  <notifications />
</post>