<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<post>
  <author>oliver</author>
  <title>Using Non-ASCII / Unicode URLs on Your Web Site</title>
  <description />
  <content>&lt;p&gt;We’re still working on &lt;a title="Marinaführer - Marinas guide" href="http://www.marinas.info" target="_blank"&gt;Marinas.info&lt;/a&gt; and were wondering if we should change any of the behavior that we use in &lt;a href="http://www.camping.info" target="_blank"&gt;Camping.info&lt;/a&gt;. There we allow for all kinds of unicode characters, from those in Eastern European languages such as &lt;a title="http://pl.camping.info/polska/śląskie/camping-pod-dębowcem-20149/położenie" href="http://pl.camping.info/polska/%C5%9Bl%C4%85skie/camping-pod-d%C4%99bowcem-20149/po%C5%82o%C5%BCenie" target="_blank"&gt;Polish&lt;/a&gt; to the Cyrillic letters of the Russian alphabet – but we encode them properly using HttpServerUtility.UrlPathEncode(). This is the behavior that &lt;a href="http://tools.ietf.org/html/rfc3986#section-2.1"&gt;RFC 3986 on URIs defines in section 2.1&lt;/a&gt;. It also means that all links that are rendered on pages on Camping.info are correctly encoded and will work in all browsers, even text based ones.&lt;/p&gt;  &lt;h2&gt;Problems with Internet Explorer&lt;/h2&gt;  &lt;p&gt;The drawback of encoded URLs is that Internet Explorer &lt;strong&gt;will not&lt;/strong&gt; decode them in the address the way all other major browsers do (Firefox, Chrome, Opera, haven’t checked Safari), so all those Internet Explorer users out there will see something like &lt;a title="http://pl.camping.info/polska/%C5%9Bl%C4%85skie/camping-pod-d%C4%99bowcem-20149/po%C5%82o%C5%BCenie" href="http://pl.camping.info/polska/%C5%9Bl%C4%85skie/camping-pod-d%C4%99bowcem-20149/po%C5%82o%C5%BCenie"&gt;http://pl.camping.info/polska/%C5%9Bl%C4%85skie/camping-pod-d%C4%99bowcem-20149/po%C5%82o%C5%BCenie&lt;/a&gt; – which is, to put it mildly, unreadable. Go ahead and copy that URL into any of the other browsers and they will reformat it to &lt;a title="http://pl.camping.info/polska/śląskie/camping-pod-dębowcem-20149/położenie" href="http://pl.camping.info/polska/śląskie/camping-pod-dębowcem-20149/położenie"&gt;http://pl.camping.info/polska/śląskie/camping-pod-dębowcem-20149/położenie&lt;/a&gt; but behind the scene will still use the encoded URL.&lt;/p&gt;  &lt;p&gt;Another problem occurs when you enter a URL that contains non-ASCII characters directly into IE’s address bar. The initial page load will succeed as IE properly encodes the URL. But once you want to POST to the same page IE changes its behavior to something in my eyes inconsistent generating an error.&lt;/p&gt;  &lt;h2&gt;A deeper look behind the IE scenes&lt;/h2&gt;  &lt;p&gt;This is what the error looks like in &lt;a href="http://www.fiddler2.com/fiddler2/" target="_blank"&gt;Fiddler&lt;/a&gt;:&lt;/p&gt;  &lt;p&gt;&lt;a href="http://shades-of-orange.com/image.axd?picture=image_52.png"&gt;&lt;img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://shades-of-orange.com/image.axd?picture=image_thumb_52.png" width="1177" height="127" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;As you can see, IE replaced the Polish special characters from the first three URL segments and encoded only the last part which is also what’s inside the form’s action attribute:&lt;/p&gt;  &lt;p&gt;&lt;a href="http://shades-of-orange.com/image.axd?picture=image_53.png"&gt;&lt;img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://shades-of-orange.com/image.axd?picture=image_thumb_53.png" width="817" height="55" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;Who would have thought! As you can see in the first screenshot, for the URL &lt;a href="http://www.camping.info/&amp;ouml;sterreich/nieder&amp;ouml;sterreich"&gt;www.camping.info/österreich/niederösterreich&lt;/a&gt; something similar happens with the difference that IE replaces the &lt;strong&gt;ö&lt;/strong&gt; by the byte with value &lt;strong&gt;&lt;font face="Courier New"&gt;F6&lt;/font&gt;&lt;/strong&gt; in hex or &lt;font face="Courier New"&gt;&lt;strong&gt;246&lt;/strong&gt;&lt;/font&gt; in decimal. To make the following screenshots I saved the whole request (as Fiddler intercepted it) to a file and looked at it using the &lt;a href="http://mh-nexus.de/en/hxd/" target="_blank"&gt;hex editor HxD:&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;&lt;a href="http://shades-of-orange.com/image.axd?picture=image_54.png"&gt;&lt;img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://shades-of-orange.com/image.axd?picture=image_thumb_54.png" width="613" height="86" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;According to the table &lt;a href="http://www.utf8-chartable.de/"&gt;http://www.utf8-chartable.de/&lt;/a&gt;,&lt;font face="Courier New"&gt; &lt;strong&gt;F6&lt;/strong&gt; &lt;/font&gt;is the Unicode code point for the small letter&lt;font face="Courier New"&gt; &lt;strong&gt;ö&lt;/strong&gt;&lt;/font&gt;, whose UTF-8 representation is&lt;font face="Courier New"&gt; &lt;strong&gt;C3 B6 &lt;/strong&gt;&lt;/font&gt;which we can find e.g. in the referrer of the same request:&lt;/p&gt;  &lt;p&gt;&lt;a href="http://shades-of-orange.com/image.axd?picture=image_55.png"&gt;&lt;img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://shades-of-orange.com/image.axd?picture=image_thumb_55.png" width="615" height="134" /&gt;&lt;/a&gt;&lt;/p&gt;  &lt;p&gt;So it turns out IE uses 3(!) different encodings to transmit the same letter ö: its Unicode code point, the URL encoded version proposed by RFC 3986, and the UTF-8 encoded version. Wow! Unfortunately, IIS and our application don’t play well with that.&lt;/p&gt;  &lt;h2&gt;&lt;/h2&gt;  &lt;h2&gt;Conclusion - Support Encoded URLs anyway&lt;/h2&gt;  &lt;p&gt;We decided anyway to support those encoded URLs for our new portals including Marinas.info to be able to SEO our pages according to their content even through their URL. Maybe IE 10 will decode those URLs in the address bar and get a grip on handling URL and form action uniformly – for their users’ sake!&lt;/p&gt;          &lt;p&gt;Happy encoding!&lt;/p&gt;</content>
  <ispublished>True</ispublished>
  <isdeleted>False</isdeleted>
  <iscommentsenabled>True</iscommentsenabled>
  <pubDate>2012-08-24 16:22:40</pubDate>
  <lastModified>2012-08-24 16:55:56</lastModified>
  <raters>0</raters>
  <rating>0</rating>
  <slug>Using-Non-ASCII-Unicode-URLs-on-Your-Web-Site</slug>
  <tags />
  <comments />
  <categories>
    <category>3b5447eb-ff3b-4481-9287-0508fce6262b</category>
    <category>e7922560-6aa6-4393-9597-1b8507bb6379</category>
  </categories>
  <notifications />
</post>